import express from 'express';
import cors from 'cors';
import fetch from 'node-fetch';
import dotenv from 'dotenv';

dotenv.config();

const app = express();
const PORT = 3001;

app.use(cors());
app.use(express.json({ limit: '50mb' }));

// Gemini API í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸
app.post('/api/generate-story', async (req, res) => {
  try {
    const { images, userKeywords } = req.body;

    if (!images || !Array.isArray(images) || images.length === 0) {
      return res.status(400).json({ error: 'ì‚¬ì§„ì´ í•„ìš”í•©ë‹ˆë‹¤.' });
    }

    if (!userKeywords) {
      return res.status(400).json({ error: 'í‚¤ì›Œë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.' });
    }

    const API_KEY = process.env.VITE_GEMINI_API_KEY;

    if (!API_KEY) {
      return res.status(500).json({ error: 'API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' });
    }

    const imageParts = images.map((img) => ({
      inlineData: {
        mimeType: img.mimeType,
        data: img.base64.split(',')[1],
      },
    }));

    const fullPrompt = `ë‹¹ì‹ ì€ í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ ì „ë¬¸ ë¼ì´í„°ìž…ë‹ˆë‹¤. 14ìž¥ ì‚¬ì§„ì„ ë¶„ì„í•˜ì—¬ "ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„°" ê³ ê°í›„ê¸°ë¥¼ ìž‘ì„±í•©ë‹ˆë‹¤.

[ðŸŽ¯ í•µì‹¬ ê´€ì ]
í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ì„ ê°€ëŠ” ì‚¬ëžŒ ìž…ìž¥ì—ì„œì˜ ê³ ê°í›„ê¸°ë¥¼ ìž‘ì„±í•´ì£¼ì‹­ì‹œì˜¤.
- ì—…ë¬´ íš¨ìœ¨ì„±: ë¹„ì¦ˆë‹ˆìŠ¤ ì„¼í„°, íšŒì˜ì‹¤, ì™€ì´íŒŒì´ ë“±
- íœ´ì‹ê³¼ íšŒë³µ: í”¼ë¡œ íšŒë³µ, ìˆ™ë©´, ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ
- íŽ¸ì˜ì„±: ìœ„ì¹˜, êµí†µ, ì‹ì‚¬, ì„œë¹„ìŠ¤
- ë¹„ìš© ëŒ€ë¹„ ê°€ì¹˜: í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ì˜ í•©ë¦¬ì„±

[í˜¸í…” ì •ë³´ - ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„°]
í˜¸í…” ë“±ê¸‰: 4ì„± í˜¸í…”
ìœ„ì¹˜: í˜¸ì¹˜ë¯¼ ì¤‘ì‹¬ë¶€
ì£¼ìš” ì‹œì„¤:
- 1ì¸µ: ë¡œë¹„, ì»¤í”¼ìˆ
- 2ì¸µ: ì¡°ì‹ ë·”íŽ˜
- 3ì¸µ: ìˆ˜ì˜ìž¥, ë¯¸ë‹ˆ ë°”
- 4ì¸µ: ë§ˆì‚¬ì§€ ì‹œì„¤, í—¬ìŠ¤/í”¼íŠ¸ë‹ˆìŠ¤
- 19ì¸µ: í”„ë¦¬ë¯¸ì–´ ë¼ìš´ì§€
- 20ì¸µ: ë£¨í”„íƒ‘ë°”

ê¸€ ìž‘ì„± ì‹œ ì´ëŸ¬í•œ êµ¬ì²´ì ì¸ ì‹œì„¤ ì •ë³´ë¥¼ ìµœëŒ€í•œ ë§Žì´ í¬í•¨í•˜ì—¬ ìƒìƒí•˜ê³  ì‹ ë¢°ê° ìžˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í•´ì£¼ì„¸ìš”.

[1ï¸âƒ£ ê¸°ë³¸ ì„¤ì •]
- ëª©í‘œ: 16ê°œ ë¬¸ë‹¨, ì •í™•ížˆ ì™„ì„±
- í†¤: ë°œëž„ 80% + ìœ ë¨¸ëŸ¬ìŠ¤ 10% + ì „ë¬¸ì„± 10%
- ì–´ë¯¸: íšŒìƒí˜• êµ¬ì–´ì²´ (~í–ˆì£ , ~ë”êµ°ìš”, ~ê°™ì•˜ì–´ìš”)
- ê°íƒ„ë¶€í˜¸: ì ˆëŒ€ ê¸ˆì§€
- ê¸¸ì´: í•œ ë¬¸ìž¥ 25ìž ì´ë‚´ (ì§§ê²Œ ëŠê¸°)
- ë¬¸ë‹¨: 3~4ë¬¸ìž¥ êµ¬ì„±
- ê´€ì : ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ìžì˜ ì‹¤ì§ˆì  í•„ìš”ì™€ ë§Œì¡±ë„

[2ï¸âƒ£ ì œëª© ê·œì¹™ - ë°˜ë“œì‹œ ì‚¬ìš©ìž í‚¤ì›Œë“œ í¬í•¨]
í˜•ì‹: ì œëª©: [ì‚¬ìš©ìž ìž…ë ¥ í‚¤ì›Œë“œ], [ê°ê°ì  í‘œí˜„]
ì˜ˆ: ì œëª©: ${userKeywords}, í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ì˜ í˜„ëª…í•œ ì„ íƒ
ì˜ˆ: ì œëª©: ${userKeywords}, ì¼ê³¼ íœ´ì‹ì´ ì–´ìš°ëŸ¬ì§„ ê²½í—˜

ê·œì¹™:
- "ì œëª©:"ìœ¼ë¡œ ì‹œìž‘
- ë°˜ë“œì‹œ ì‚¬ìš©ìž ìž…ë ¥ í‚¤ì›Œë“œ(${userKeywords}) ì •í™•ížˆ 1íšŒ ì‚¬ìš©
- ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„° ë˜ëŠ” ë‹¤ë¥¸ ì—…ì²´ëª… 1íšŒ ì‚¬ìš©
- ë§ˆì¹¨í‘œ/íŠ¹ìˆ˜ë¬¸ìž ê¸ˆì§€
- ì‚¬ìš©ìž í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ì ˆëŒ€ ì œëª©ì„ ì™„ì„±í•˜ì§€ ë§ ê²ƒ

[3ï¸âƒ£ í‚¤ì›Œë“œ ë°°ì¹˜ - ì •í™•ížˆ 5íšŒ, ë°˜ë“œì‹œ ì¤€ìˆ˜]
í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸:
1. ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„°
2. í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œ
3. í˜¸ì¹˜ë¯¼í˜¸í…”
4. í˜¸ì¹˜ë¯¼í˜¸í…” ì¶”ì²œ
5. í˜¸ì¹˜ë¯¼ ë…¸ë³´í…”
6. í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤

ë°˜ë“œì‹œ ì¤€ìˆ˜ ë°°ì¹˜ ê·œì¹™:
- ì œëª©: ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„° ë˜ëŠ” í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œ ì¤‘ 1ê°œ ë°˜ë“œì‹œ ì‚¬ìš©
- 1ë²ˆ ì„œë¡ : ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„° ë˜ëŠ” í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤ ë°˜ë“œì‹œ 1íšŒ ì‚¬ìš©
- 5~6ë²ˆ ì¤‘: í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œ ë˜ëŠ” í˜¸ì¹˜ë¯¼í˜¸í…” ë°˜ë“œì‹œ 1íšŒ ì‚¬ìš©
- 8~9ë²ˆ ì¤‘: í˜¸ì¹˜ë¯¼ ë…¸ë³´í…” ë˜ëŠ” í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤ ë°˜ë“œì‹œ 1íšŒ ì‚¬ìš©
- 11~12ë²ˆ ì¤‘: í˜¸ì¹˜ë¯¼í˜¸í…” ì¶”ì²œ ë˜ëŠ” í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œ ë°˜ë“œì‹œ 1íšŒ ì‚¬ìš©
- 16ë²ˆ ê²°ë¡ : ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„° ë˜ëŠ” í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤ ë°˜ë“œì‹œ 1íšŒ ì‚¬ìš©

ì¤‘ìš”: ì •í™•ížˆ 5ê°œì˜ í‚¤ì›Œë“œë¥¼ ë‚´ë‚´ ë‹¤ë¥¸ ìœ„ì¹˜ì— ë°˜ë“œì‹œ ì‚¬ìš©í•  ê²ƒ

ê¸ˆì§€:
- í•œ ë¬¸ìž¥ì— 2íšŒ ì´ìƒ
- í•œ ë¬¸ë‹¨ì— 2íšŒ ì´ìƒ
- ë‘ í‚¤ì›Œë“œ ì§ê²°
- ì œëª©ì— ë‘ í‚¤ì›Œë“œ ì‚¬ìš©

[4ï¸âƒ£ í‚¤ì›Œë“œ ì‚½ìž… ë°©ì‹ - ìžì—°ìŠ¤ëŸ½ê³  ë¬¸ë²•ì ìœ¼ë¡œ ë…¹ì•„ë“¤ê¸°]

âœ… ì‹œì  ì¼ê´€ì„± (ê°•ì œ):
- ëª¨ë“  ê¸°ì–µì€ ê³¼ê±°ì‹ íšŒìƒìœ¼ë¡œ ì¼ê´€ë˜ì–´ì•¼ í•¨
- ê¸ˆì§€: "ì°¾ëŠ” ë¶„ë“¤ì„ ìœ„í•´", "í•„ìš”ë¡œ í•˜ëŠ” ë¶„ë“¤ì—ê²Œ" (ë¯¸ëž˜ì‹œì œ)
- ì‚¬ìš©: "ì°¾ì•„ë³¸ ë§Œí•œ", "í•„ìš”ë¡œ í–ˆë˜ ì¡°ê±´ì„ ê°–ì¶˜" (ê³¼ê±°ì‹)

âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ìž ê´€ì ì˜ ì‚½ìž…:
- ì—…ë¬´ íš¨ìœ¨ì„±: "í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤ í˜¸í…”ë‹µê²Œ ì—…ë¬´ ê³µê°„ì´ ìž˜ ê°–ì¶°ì ¸ ìžˆì—ˆì–´ìš”."
- íœ´ì‹ ê°•ì¡°: "í˜¸ì¹˜ë¯¼í˜¸í…” ì¶”ì²œì„ ë°›ì„ ë§Œí•œ ì´ìœ ê°€ ìˆ™ë©´ì— ìžˆì—ˆì£ ."
- ìœ„ì¹˜/ì ‘ê·¼ì„±: "í˜¸ì¹˜ë¯¼ ë…¸ë³´í…”ì´ë¼ëŠ” í‰ê°€ê°€ êµí†µ íŽ¸ì˜ì„±ì—ì„œ ë“œëŸ¬ë‚¬ì–´ìš”."
- ì„œë¹„ìŠ¤ í’ˆì§ˆ: "í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œì´ë¼ëŠ” ì›ƒì„ ëŠë‚„ ìˆ˜ ìžˆì—ˆì–´ìš”."
- ê°€ì¹˜ í‰ê°€: "í˜¸ì¹˜ë¯¼í˜¸í…” ì¤‘ì—ì„œë„ ì´ê³³ì´ ì¶œìž¥ìž ìž…ìž¥ì—ì„œ ìµœê³ ì˜€ì–´ìš”."

âœ… ìµœê³ ì˜ ì‚½ìž… ê¸°ë²•:
- ë¬¸ìž¥ ì¤‘ê°„ì— ìžì—°ìŠ¤ëŸ½ê²Œ: "ì¹¨êµ¬ì˜ ì§ˆê°ì´ í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤ ê¸°ì¤€ì— ë¶€í•©í–ˆì–´ìš”."
- ëª…ì‚¬êµ¬ë¡œ í™œìš©: "í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œì„ ë°›ì„ ë§Œí•œ ê³µê°„ì´ì—ˆì£ ."
- ì„œìˆ ì–´ì™€ ê²°í•©: "í˜¸ì¹˜ë¯¼ ë…¸ë³´í…”ë‹¤ìš´ ë¶„ìœ„ê¸°ê°€ ë¬¼ì”¬ í’€ê²¼ì–´ìš”."
- ë¹„êµ í‘œí˜„: "ì˜ˆìƒí–ˆë˜ í˜¸ì¹˜ë¯¼í˜¸í…” ì¶”ì²œë³´ë‹¤ í›¨ì”¬ ë‚˜ì™”ì–´ìš”."
- ê°ê° í‘œí˜„ê³¼ í•¨ê»˜: "í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤í•œ ëŠë‚Œì˜ ì¡°ëª…ì´ ì¢‹ì•˜ì£ ."
- ê´€ì°°í˜• ë°§ê²¬: "í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œìœ¼ë¡œ ì•Œë ¤ì§„ ì´ìœ ê°€ ì—¬ê¸°ì„œ ë“œëŸ¬ë‚¬ì–´ìš”."
- ê²°ê³¼ ê¸°ë°˜: "ë…¸ë³´í…” ì‚¬ì´ê³µì„¼í„°ë¼ëŠ” í‰ê°€ë¥¼ ëŠë‚„ ìˆ˜ ìžˆì—ˆì£ ."

âœ… ì•ˆì „í•œ ì‚½ìž…:
- ê²½í—˜ íšŒê³ : "ì´ ë¶€ë¶„ì´ í˜¸ì¹˜ë¯¼í˜¸í…” ì¶”ì²œì—ì„œ ê¸°ì–µì— ë‚¨ì•˜ì–´ìš”."
- ìƒí™© ì„¤ëª…: "í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤í´ëž˜ìŠ¤ ë²”ì£¼ì— í¬í•¨ë  ì¡°ê±´ì„ ê°–ì¶”ê³  ìžˆì—ˆì£ ."
- ê´€ì°°í˜•: "í˜¸ì¹˜ë¯¼ ë…¸ë³´í…”ìœ¼ë¡œ ì•Œë ¤ì§„ ë§Œí•œ ì´ìœ ê°€ ìžˆì–´ìš”."

âŒ ìœ„í—˜ (ì ˆëŒ€ ê¸ˆì§€):
- "ì°¾ëŠ” ë¶„ë“¤ì„ ìœ„í•´", "í•„ìš”ë¡œ í•˜ëŠ” ë¶„ë“¤ì—ê²Œ" (ì‹œì  ì˜¤ë¥˜)
- "í˜¸ì¹˜ë¯¼ 4ì„±í˜¸í…” ì¶”ì²œì„ ë“œë¦½ë‹ˆë‹¤" (ë™ì˜ì˜ ê³¼ë‹¤ ì‚¬ìš©)
- "ì™„ë²½í•œ í˜¸ì¹˜ë¯¼í˜¸í…”ì€ ìµœê³ ìž…ë‹ˆë‹¤" (ì ˆëŒ€ í‘œí˜„)
- í‚¤ì›Œë“œ ì•žì— "ë§¤ìš°", "ì •ë§", "ë§¤ìš°" ê°™ì€ ìˆ˜ì‹ì–´ ê³¼ë‹¤ ì‚¬ìš©
- "ì™„ë²½í•œ", "ìµœê³ ", "ë§¤ìš°" ë“± ì ˆëŒ€ í‘œí˜„ ê¸ˆì§€

[5ï¸âƒ£ í†¤ê³¼ ìŠ¤íƒ€ì¼ - ë°œëž„ 80% + ìœ ë¨¸ëŸ¬ìŠ¤ 10% + ì „ë¬¸ì„± 10%]

ë°œëž„ 80%:
- ìƒìƒí•œ ê°ì • í‘œí˜„
- í™œê¸°ì°¬ ë¦¬ë“¬ê°
- ê¸ì •ì ì´ê³  ë°ì€ í†¤
- êµ¬ì²´ì  ë””í…Œì¼ ë¬˜ì‚¬
- ë§ˆì¹˜ ì¹œêµ¬ì—ê²Œ ì´ì•¼ê¸°í•˜ëŠ” ë“¯í•œ ìžì—°ìŠ¤ëŸ¬ì›€

ìœ ë¨¸ëŸ¬ìŠ¤ 10%:
- ê°€ë²¼ìš´ ìœ„íŠ¸ (ìžì¡°ì ì´ì§€ ì•Šê²Œ)
- ìƒí™©ì˜ ìž¬ë¯¸ìžˆëŠ” ì¸¡ë©´ í¬ì°©
- ë”°ëœ»í•œ ì›ƒìŒ ìœ ë„
- ê³¼ìž¥ ì—†ëŠ” ìžì—°ìŠ¤ëŸ¬ìš´ ìœ ë¨¸
- ì˜ˆ: "ì¹¨ëŒ€ëŠ” ì •ë§ í¬ê·¼í–ˆì–´ìš”. ë‚˜ì˜¬ ìƒê°ì´ ì•ˆ ë“¤ ì •ë„ë¡œ."

ì „ë¬¸ì„± 10%:
- í˜¸í…” ì„œë¹„ìŠ¤ ì´í•´ë„ í‘œí˜„
- ê°ê´€ì  ê´€ì°°
- ì‹ ë¢°ê° ìžˆëŠ” í‘œí˜„
- ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ìžì˜ ì‹¤ì§ˆì  í•„ìš” ì´í•´

ê°€ë…ì„± ê·œì¹™:
- ê°ì • ë¬¸ìž¥ 2ì¤„ ì—°ì† ê¸ˆì§€ â†’ ê¸°ëŠ¥ ì„¤ëª… ì‚½ìž…
- ë™ì¼ ì¢…ê²°ì–´ë¯¸ 3íšŒ ì´ìƒ ë°˜ë³µ ê¸ˆì§€
- ì¶”ìƒì–´ ê¸ˆì§€ (êµ¬ì²´ ë¬˜ì‚¬ë§Œ)
- ì ‘ì†ì‚¬ ë‚¨ë°œ ê¸ˆì§€
- ì˜ë¬¸í˜• 10% í¬í•¨
- ë¬¸ìž¥ ì‹œìž‘ ë‹¤ì–‘í™” ("ê·¸ëŸ°ë°", "ê·¸ëž˜ì„œ", "í•˜ì§€ë§Œ" ë“± ì œí•œ)
- ê°™ì€ ê¸¸ì´ì˜ ë¬¸ìž¥ 3ê°œ ì—°ì† ê¸ˆì§€
- ë¬¸ìž¥ ê¸¸ì´ ë³€í™”: ì§§ì€ ë¬¸ìž¥(10~15ìž) â†’ ì¤‘ê°„ ë¬¸ìž¥(20~25ìž) â†’ ì§§ì€ ë¬¸ìž¥ ìˆœì„œ
- ì½ì„ ë•Œ íŽ¸í•œ ì†ë„ê° ê³ ë ¤

ìžì—°ìŠ¤ëŸ¬ìš´ íë¦„:
- ê° ë¬¸ë‹¨ì€ ì‹œìž‘-ì „ê°œ-ë§ˆë¬´ë¦¬ êµ¬ì¡°
- ë¬¸ë‹¨ ê°„ ë…¼ë¦¬ì  ì—°ê²°ì„± ìœ ì§€
- ì‹œê°„ íë¦„ ìžì—°ìŠ¤ëŸ½ê²Œ ì§„í–‰
- ìž¥ì†Œ ì´ë™ì´ ìžì—°ìŠ¤ëŸ¬ì›€
- ê°ì •ê³¼ ì‚¬ì‹¤ì´ ê· í˜•ìžˆê²Œ ë°°ì¹˜

[6ï¸âƒ£ ë¬¸ìž¥ êµ¬ì¡° - ë¦¬ë“¬ê° ìžˆëŠ” ê¸€ì“°ê¸°]

ë¬¸ìž¥ ê¸¸ì´:
- í•œ ë¬¸ìž¥ 25ìž ì´ë‚´ (ê¸°ë³¸)
- ë‹¨ë¬¸ ìœ„ì£¼ (ì§§ê²Œ ëŠê¸°)
- í•œ ë¬¸ë‹¨ 3~4ë¬¸ìž¥
- ë™ì¼ êµ¬ì¡° ë°˜ë³µ ê¸ˆì§€
- ë¬¸ìž¥ ê¸¸ì´ ë³€í™”: ì§§ì€ ë¬¸ìž¥(10~15ìž) â†’ ì¤‘ê°„ ë¬¸ìž¥(20~25ìž) â†’ ì§§ì€ ë¬¸ìž¥ ìˆœì„œ

ë¦¬ë“¬ê°:
- ë‹¨ì¡°ë¡œìš´ ë¬¸ìž¥ ë°˜ë³µ ê¸ˆì§€
- ë¬¸ìž¥ ë ë‹¤ì–‘í™” ("ì–´ìš”", "ì—ˆì£ ", "ë”êµ°ìš”", "ê°™ì•˜ì–´ìš”" ë“±)
- ìžì—°ìŠ¤ëŸ¬ìš´ í˜¸í¡ ìœ ì§€
- ì½ì„ ë•Œ íŽ¸í•œ ì†ë„ê° ê³ ë ¤

[ë¶„ëŸ‰ ê´€ë¦¬ - ë°˜ë“œì‹œ ì¤€ìˆ˜]
- ê³µë°± ì œì™¸ 2900ìž ì´ìƒ í•„ìˆ˜ (250 + 150Ã—14 + 250)
- ì„œë¡ (1ë²ˆ): ë°˜ë“œì‹œ 250ìž ì´ìƒ (ìµœì†Œ ê¸°ì¤€)
- ë³¸ë¬¸(2~15ë²ˆ): ê° ë¬¸ë‹¨ ë°˜ë“œì‹œ 150ìž ì´ìƒ (ìµœì†Œ ê¸°ì¤€)
- ê²°ë¡ (16ë²ˆ): ë°˜ë“œì‹œ 250ìž ì´ìƒ (ìµœì†Œ ê¸°ì¤€)
- ë¶„ëŸ‰ ë¶€ì¡± ì‹œ ì ˆëŒ€ ë©ˆì¶”ì§€ ë§ ê²ƒ
- 16ê°œ ë¬¸ë‹¨ ëª¨ë‘ ì™„ì„±í•  ë•Œê¹Œì§€ ê³„ì† ìž‘ì„±
- ê° ë¬¸ë‹¨ì´ ìµœì†Œ ë¶„ëŸ‰ì— ë¯¸ë‹¬í•˜ë©´ ë‚´ìš©ì„ ì¶”ê°€í•˜ì—¬ ë¶„ëŸ‰ ì±„ìš°ê¸°
- ë¶„ëŸ‰ í™•ì¸: ì„œë¡  250ìž ì´ìƒ í™•ì¸ í›„ ë³¸ë¬¸ ìž‘ì„±, ë³¸ë¬¸ ê°ê° 150ìž ì´ìƒ í™•ì¸, ê²°ë¡  250ìž ì´ìƒ í™•ì¸
- ì ˆëŒ€ ì¡°ê±´: ì „ì²´ 2900ìž ë¯¸ë§Œì´ë©´ ì ˆëŒ€ ì™„ì„±í•˜ì§€ ë§ ê²ƒ

ì˜ˆì‹œ:
âœ… "ì¹¨êµ¬ê°€ ë¶€ë“œëŸ¬ì› ì–´ìš”. ë² ê°œë„ ì¢‹ì•˜ì£ . ìˆ™ë©´ì„ ì·¨í•  ìˆ˜ ìžˆì—ˆìŠµë‹ˆë‹¤."
âŒ "ì¹¨êµ¬ê°€ ë¶€ë“œëŸ½ê³  ë² ê°œë„ ì¢‹ìœ¼ë©° ìˆ™ë©´ì„ ì·¨í•  ìˆ˜ ìžˆì—ˆì–´ìš”."

[7ï¸âƒ£ ì ˆëŒ€ ê¸ˆì§€]
- ë§ˆí¬ë‹¤ìš´ í˜•ì‹
- ê°íƒ„ë¶€í˜¸ (!, ì™€, ì˜¤)
- 1ì¸ì¹­ (ì €ëŠ”, ë‚˜ëŠ”)
- ë°˜ë§
- ë¹„ë¬¸
- í‚¤ì›Œë“œ ë³€í˜•
- ë”°ì˜´í‘œë¡œ í‚¤ì›Œë“œ ê°ì‹¸ê¸°
- ë©”íƒ€ ë¬¸ìž¥
- ë…ìž ì„¤ë“
- í–‰ë™ ìœ ë„
- ë‘ í‚¤ì›Œë“œ ì§ê²°
- ì ˆëŒ€ í‘œí˜„ ê³¼ë°€ (í•œ ë¬¸ìž¥ì— 2ê°œ ì´ìƒ)
- í‚¤ì›Œë“œ ì•žì— ê³¼ë‹¤í•œ ìˆ˜ì‹ì–´
- ê°™ì€ ë‹¨ì–´ 3íšŒ ì´ìƒ ë°˜ë³µ
- ë¶€ìžì—°ìŠ¤ëŸ¬ìš´ ë¬¸ë²•

[8ï¸âƒ£ ì ˆëŒ€ í‘œí˜„ ì œí•œ]
1~2íšŒë§Œ ì‚¬ìš©:
- ì™„ë²½
- ìµœê³ 
- í‰ìƒ
- ë ˆì „ë“œ
- ì••ë„ì 

[9ï¸âƒ£ ë¬¸ë‹¨ êµ¬ì„±]
1ë²ˆ: ì„œë¡  (í˜¸ì¹˜ë¯¼ ì¶œìž¥ ì‹œìž‘, ê¸°ëŒ€ê°, í‚¤ì›Œë“œ 1íšŒ)
2~4ë²ˆ: ë¹„í–‰ ì „ ë¼ìš´ì§€, ê¸°ë‚´ì‹, í˜¸í…” ë„ì°©
5~6ë²ˆ: ì²´í¬ì¸, ê°ì‹¤ ìž…ìž¥, ì—…ë¬´ ê³µê°„ (í‚¤ì›Œë“œ 1íšŒ)
7~9ë²ˆ: ê°ì‹¤ ì„¸ë¶€ (ì¹¨ëŒ€, ìš•ì‹¤, ì†ŒíŒŒ, íœ´ì‹)
10~12ë²ˆ: ë£¨í”„íƒ‘, ë°”, í…Œë¼ìŠ¤, ë¹„ì¦ˆë‹ˆìŠ¤ ì„¼í„° (í‚¤ì›Œë“œ 2íšŒ)
13~15ë²ˆ: ë¼ìš´ì§€, ì¡°ì‹, ì¶œìž¥ ë§ˆë¬´ë¦¬
16ë²ˆ: ê²°ë¡  (íšŒê³ í˜•, ë‹¤ìŒ ì¶œìž¥ ê¸°ëŒ€, í‚¤ì›Œë“œ 1íšŒ)

[ðŸ”Ÿ ì¶œë ¥ í˜•ì‹]
ì œëª©: [ì œëª© ë‚´ìš©]

Business Consultant
2026ë…„ 2ì›” 26ì¼

1. ì²« ë²ˆì§¸ ë¬¸ë‹¨
2. ë‘ ë²ˆì§¸ ë¬¸ë‹¨
...
16. ë§ˆì§€ë§‰ ë¬¸ë‹¨

[í•µì‹¬]
- í˜¸ì¹˜ë¯¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì¶œìž¥ìž ìž…ìž¥ì—ì„œ ìž‘ì„±
- ì—…ë¬´ íš¨ìœ¨ì„±ê³¼ íœ´ì‹ì˜ ë°¸ëŸ°ìŠ¤ ê°•ì¡°
- í˜¸í…”ì˜ êµ¬ì²´ì  ì‹œì„¤ ì •ë³´ë¥¼ ìµœëŒ€í•œ í¬í•¨
- 16ê°œ ë¬¸ë‹¨ ëª¨ë‘ ì™„ì„±í•  ë•Œê¹Œì§€ ê³„ì† ìž‘ì„±
- ì ˆëŒ€ ì¤‘ê°„ì— ë©ˆì¶”ì§€ ë§ ê²ƒ
- ê° ë¬¸ë‹¨ì€ ì™„ì „í•œ ë¬¸ìž¥ìœ¼ë¡œ ë§ˆë¬´ë¦¬
- ë°œëž„í•˜ë©´ì„œë„ ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê³  ì‹ ë¢°ê° ìžˆëŠ” í†¤ ìœ ì§€
- í‚¤ì›Œë“œê°€ ìžì—°ìŠ¤ëŸ½ê²Œ ë…¹ì•„ë“¤ì–´ì•¼ í•¨
- ë§ˆì¹˜ ì¹œêµ¬ì—ê²Œ ì´ì•¼ê¸°í•˜ëŠ” ë“¯í•œ ìžì—°ìŠ¤ëŸ¬ìš´ ê¸€ì“°ê¸°`;

    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [
                {
                  text: fullPrompt,
                },
                ...imageParts,
              ],
            },
          ],
          generationConfig: {
            temperature: 0.7,
            topK: 40,
            topP: 0.95,
            maxOutputTokens: 12000,
          },
        }),
      }
    );

    if (!response.ok) {
      const errorData = await response.json();
      console.error('Gemini API ì˜¤ë¥˜:', errorData);
      return res.status(response.status).json({ error: errorData.error?.message || 'API ì˜¤ë¥˜' });
    }

    const data = await response.json();
    const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text || '';

    if (!generatedText) {
      return res.status(500).json({ error: 'APIì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.' });
    }

    res.json({ story: generatedText });
  } catch (error) {
    console.error('ì„œë²„ ì˜¤ë¥˜:', error);
    res.status(500).json({ error: error.message });
  }
});

app.listen(PORT, () => {
  console.log(`ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${PORT}`);
});
